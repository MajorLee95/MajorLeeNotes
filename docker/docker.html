
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Docker* &#8212; Documentation MajorLee&#39;s notes </title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Arduino" href="../arduino/arduino.html" />
    <link rel="prev" title="Notes sur git" href="../git/git.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../arduino/arduino.html" title="Arduino"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="../git/git.html" title="Notes sur git"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation MajorLee&#39;s notes </a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="docker">
<h1><a class="toc-backref" href="#sommaire">Docker*</a><a class="headerlink" href="#docker" title="Lien permanent vers ce titre">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Auteur</dt>
<dd class="field-odd"><p>J.Soranzo</p>
</dd>
<dt class="field-even">Date</dt>
<dd class="field-even"><p>Janvier 2020 2019</p>
</dd>
<dt class="field-odd">Societe</dt>
<dd class="field-odd"><p>VoRoBoTics</p>
</dd>
<dt class="field-even">Entity</dt>
<dd class="field-even"><p>VoLAB</p>
</dd>
</dl>
<div class="contents topic" id="sommaire">
<p class="topic-title">Sommaire</p>
<ul class="simple">
<li><p><a class="reference internal" href="#docker" id="id72">Docker*</a></p>
<ul>
<li><p><a class="reference internal" href="#start-up-install" id="id73">Start-up /install</a></p>
<ul>
<li><p><a class="reference internal" href="#dockerhub" id="id74">Dockerhub</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#notes" id="id75">Notes</a></p>
<ul>
<li><p><a class="reference internal" href="#definitions" id="id76">Définitions</a></p></li>
<li><p><a class="reference internal" href="#ma-presentation-rapide-pratique" id="id77">Ma présentation rapide pratique</a></p></li>
<li><p><a class="reference internal" href="#grands-principes" id="id78">Grands principes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#documentation" id="id79">Documentation</a></p></li>
<li><p><a class="reference internal" href="#retour-dans-la-doc-officielle" id="id80">Retour dans la doc officielle.</a></p></li>
<li><p><a class="reference internal" href="#commandes-principales" id="id81">Commandes principales</a></p></li>
<li><p><a class="reference internal" href="#creer-une-image" id="id82">Créer une image</a></p>
<ul>
<li><p><a class="reference internal" href="#syntaxe-des-fichiers-dockerfile" id="id83">Syntaxe des fichiers Dockerfile</a></p></li>
<li><p><a class="reference internal" href="#un-exercice" id="id84">Un exercice</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#syntaxe-des-fichiers-docker-compose" id="id85">Syntaxe des fichiers Docker compose</a></p></li>
<li><p><a class="reference internal" href="#piloter-un-port-serie-de-la-machine-hote" id="id86">Piloter un port série de la machine hote</a></p></li>
<li><p><a class="reference internal" href="#volumes-et-bind-mounts" id="id87">volumes et bind mounts</a></p></li>
<li><p><a class="reference internal" href="#volume-et-sauvegarde" id="id88">Volume et sauvegarde</a></p></li>
<li><p><a class="reference internal" href="#networks" id="id89">Networks</a></p></li>
<li><p><a class="reference internal" href="#docker-services-swarm" id="id90">Docker services/Swarm</a></p></li>
<li><p><a class="reference internal" href="#general-application-development-best-practices" id="id91">General application development best practices</a></p></li>
<li><p><a class="reference internal" href="#acceder-aux-donnees-cachees-de-docker-sous-windows-y-compris-les-volumes" id="id92">Accéder aux données cachées de Docker sous Windows y compris les volumes</a></p></li>
<li><p><a class="reference internal" href="#my-tips" id="id93">My tips</a></p>
<ul>
<li><p><a class="reference internal" href="#docker-port" id="id94">Docker port</a></p></li>
<li><p><a class="reference internal" href="#faire-du-python2-sans-l-installer" id="id95">Faire du python2 sans l’installer</a></p></li>
<li><p><a class="reference internal" href="#docker-run-start-and-restart" id="id96">docker run, start and restart</a></p></li>
<li><p><a class="reference internal" href="#savoir-si-une-image-a-ete-montee-avec-un-volume-ou-un-bind" id="id97">Savoir si une image a été montée avec un volume ou un bind</a></p></li>
<li><p><a class="reference internal" href="#docker-run-name-rm" id="id98">Docker run –name –rm</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#voir-docker-a-l-oeuvre" id="id99">Voir Docker à l’oeuvre</a></p></li>
<li><p><a class="reference internal" href="#vocabulaire" id="id100">Vocabulaire</a></p></li>
<li><p><a class="reference internal" href="#weblinks" id="id101">Weblinks</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="start-up-install">
<h2><a class="toc-backref" href="#sommaire">Start-up /install</a><a class="headerlink" href="#start-up-install" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pas la même install qu’il s’agisse de Windwos10pro d’un côté et Windwos10 family ou 7 de l’autre</p>
<p><a class="reference external" href="https://poltergeist42.github.io/JDM/Docker.html">Note Docker Pierre</a> <a class="footnote-reference brackets" href="#id1" id="id2">1</a></p>
<p><a class="reference external" href="https://openclassrooms.com/fr/courses/2035766-optimisez-votre-deploiement-en-creant-des-conteneurs-avec-docker/6211306-decouvrez-les-conteneurs">Docker sur Openclassroom</a> <a class="footnote-reference brackets" href="#id4" id="id5">2</a></p>
<p>Je me permet un petit commentaire sur ce cours. Il n’est vraiment pas terrible !</p>
<p>Une pauvre recette de cuisine sur dockerfile et sur compose très incomplète.</p>
<p>Par exemple on y évoque pas le partage de volume.</p>
<p>L’exercice de fin de chapitre sur nginx est juste une blague ! Attention tips, on ne demande pas
de démarrer le serveur nginx ni même de la paraméter, juste de l’installer ! Faites au plus
simple</p>
<ul class="simple">
<li><p>Docker Community Edition (Linux seulement) ;</p></li>
<li><p>Docker Desktop (Mac ou Windows) ;</p></li>
<li><p>Docker Enterprise (Linux seulement).</p></li>
<li><p>Docker toolbox (Pour wondows 7 par exemple)</p></li>
</ul>
<p>Un bon tut, je crois : <a class="reference external" href="https://docker-curriculum.com/">docker-curriculum</a> <a class="footnote-reference brackets" href="#id6" id="id7">3</a></p>
<p>Au cours de ce tutoriel en englais on apprends à déployer une apppli web static et
2 appli dynamiques</p>
<div class="section" id="dockerhub">
<h3><a class="toc-backref" href="#sommaire">Dockerhub</a><a class="headerlink" href="#dockerhub" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le <a class="reference external" href="https://hub.docker.com/search?q=&amp;type=image">site docker hub</a> <a class="footnote-reference brackets" href="#id8" id="id9">4</a> directement sur la page de recherche/exploration</p>
<p>3 702 709 available images le 06/07/2020.</p>
<p>on y trouve par exemple une image nommée gcc, gitlab, nextcloud, owncloud, mongo-express, drupal…</p>
</div>
</div>
<div class="section" id="notes">
<h2><a class="toc-backref" href="#sommaire">Notes</a><a class="headerlink" href="#notes" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="definitions">
<h3><a class="toc-backref" href="#sommaire">Définitions</a><a class="headerlink" href="#definitions" title="Lien permanent vers ce titre">¶</a></h3>
<p>J’aime bien cette définition :
Quand une application tourne dans un conteneur, elle a l’illusion d’être la seule à avoir accès
au <strong>système</strong> (sous-entendu l’OS). Ceci n’est pas sans rappeler la virtualisation, où un OS invité
a l’illusion d’être le seul à exploiter le <strong>hardware</strong> sous-jacent.</p>
<p>Par principe Docker ne doit faire tourner qu’un seul processus.</p>
<p>Ainsi, dans le cas d’une stack LAMP (Linux, Apache, MySQL, PHP), nous devons créer 3 conteneurs
différents, un pour Apache, un pour MySQL et un dernier pour PHP.</p>
<p>Immutable</p>
<p>Ce que c’est</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Docker</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">platform</span> <span class="k">for</span> <span class="n">developers</span> <span class="ow">and</span> <span class="n">sysadmins</span> <span class="n">to</span> <span class="n">build</span><span class="p">,</span> <span class="n">share</span><span class="p">,</span> <span class="ow">and</span> <span class="n">run</span> <span class="n">applications</span><span class="o">.</span>
</pre></div>
</div>
<p>ça c’est la <a class="reference external" href="https://docs.docker.com/get-started/">définition officielle</a> <a class="footnote-reference brackets" href="#id10" id="id11">5</a> . Cela ne dit pas « développer » de quelles applications. Le gros
sous entendu c’est que ce sont des applications plutôt à forte propension WEB.</p>
<p>Article très intéressant  <a class="reference external" href="https://blog.engineering.publicissapient.fr/2019/12/23/docker-est-mort-vive-docker/">Docker est mort, vive Docker</a> <a class="footnote-reference brackets" href="#id12" id="id13">6</a> sur le fonctionnement de docker (2019)</p>
</div>
<div class="section" id="ma-presentation-rapide-pratique">
<h3><a class="toc-backref" href="#sommaire">Ma présentation rapide pratique</a><a class="headerlink" href="#ma-presentation-rapide-pratique" title="Lien permanent vers ce titre">¶</a></h3>
<p>Docker ça fait tourner des images que l’on peut récupérer sur dockerhub ou dans un autre dépôt.
Ok c’est cool mais ce qui est encore plus cool c’est qu’on peut construire de nouvelles images
basées sur des images existantes à la façon des poupées russes (c’est le rôle des
dockerfiles voir <a class="reference internal" href="#creer-une-image">Créer une image</a>  ). ça c’est déjà pas mal mais ce n’est pas suffisant.</p>
<p>En effet, comme docker ne fait tourner qu’une seule tâche, process… ou quelque soit le terme
utilisé, on pourrait dire aussi un seul truc, eh bien il faut en lancer plusieurs, le cas type est
le <strong>serveur web</strong> qui utilise une <strong>base de données</strong> au travers de <strong>php</strong> pour cela il faut
lancer 3 images. C’est la qu’intervient docker compose voir <a class="reference internal" href="#syntaxe-des-fichiers-docker-compose">Syntaxe des fichiers Docker compose</a></p>
<p>Une images n’est pas un container et inversement. Donc, il faut apprendre à manipuler les 2.
On peut créer une image sans pour autant la lancer et on peut lancer une image sans la créer.
On peut également effacer des images et des container de son système, on peut lister les 2 mais
pas avec les mêmes commandes !</p>
<p>Quelques part c’est un peu frustrant au début. Exemple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">interactive</span> <span class="o">--</span><span class="n">tty</span> <span class="n">ubuntu</span> <span class="n">bash</span>
</pre></div>
</div>
<p>On a alors un Ubuntu mais c’est une coquille vide. Les principales commandes n’y sont pas !
Il faut alors soit devenir un gourou des images du docker hub ou le roi des fichiers dockerfile</p>
<p>Après quelques temps je me rends compte que Docker c’est bien mais tout est éphémère !
Exemple</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="n">busybox</span> <span class="n">sh</span>
<span class="n">puis</span> <span class="n">on</span> <span class="k">pass</span> <span class="n">des</span> <span class="n">commandes</span><span class="p">,</span> <span class="n">on</span> <span class="n">peut</span> <span class="n">créer</span> <span class="n">des</span> <span class="n">fichier</span><span class="o">...</span>
<span class="n">exit</span>
<span class="n">et</span> <span class="n">quand</span> <span class="n">on</span> <span class="n">revient</span> <span class="n">il</span> <span class="n">n</span><span class="s1">&#39;y a plus rien !</span>
<span class="n">Cela</span> <span class="n">dit</span> <span class="n">ce</span> <span class="n">n</span><span class="s1">&#39;est pas un handicap, c&#39;</span><span class="n">est</span> <span class="n">même</span> <span class="n">voulu</span> <span class="n">mais</span> <span class="n">c</span><span class="s1">&#39;est déroutant pour les novices</span>
</pre></div>
</div>
</div>
<div class="section" id="grands-principes">
<h3><a class="toc-backref" href="#sommaire">Grands principes</a><a class="headerlink" href="#grands-principes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Tiré de <a class="reference external" href="https://docs.docker.com/get-started/overview/#docker-architecture">Docker Architecture dans la doc officielle</a> <a class="footnote-reference brackets" href="#id14" id="id15">7</a></p>
<p>dockerd : docker deamon gère les images, container, réseaux et volumes</p>
<p>dockerapi : s’adresse à dockerd pour éxécuter les choses</p>
<p>dockercli ou docker client s’adresse à l’api qui s’adresse …</p>
<p>docker registry : dépôt : docker hub est le registry par défaut mais on peut utiliser
son propre registry</p>
<p id="index-0">Les layers: chaque instructions d’un dockerfile constitue un layer, chaque layer sauf le tout
dernier est en read-only. Chaque nouveau layer est constitué d’un petit nombre de différences par
rapport au précédent. Les layers sont empilés les uns au dessus des autres avec en plus au dessus
un layer dit container layer en lecture/écriture dans lequel sont fait les modifs.</p>
<p>La majeur différence en une images et un container est en fait représentée par ce dernier layer en
lecture écriture dont le contenu disparaît quand le container est arrêté.</p>
<p>Tiré de <a class="reference external" href="https://docs.docker.com/storage/storagedriver/#images-and-layers">Images and layers dans la doc officielle</a> <a class="footnote-reference brackets" href="#id16" id="id17">8</a></p>
</div>
</div>
<div class="section" id="documentation">
<h2><a class="toc-backref" href="#sommaire">Documentation</a><a class="headerlink" href="#documentation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Officiellement c’est là : <a class="reference external" href="https://docs.docker.com/">Docker’s documentation</a> <a class="footnote-reference brackets" href="#id18" id="id19">9</a></p>
<p>Mais c’est mieux de commencer par l”<a class="reference external" href="https://docs.docker.com/install/">onglet Product manual</a> <a class="footnote-reference brackets" href="#id20" id="id21">10</a> et plus particulièrement avec les</p>
<p><a class="reference external" href="https://docs.docker.com/docker-for-windows/">docker for Windows</a> <a class="footnote-reference brackets" href="#id22" id="id23">11</a>, <a class="reference external" href="https://docs.docker.com/docker-for-mac/">docker for Mac</a> <a class="footnote-reference brackets" href="#id24" id="id25">12</a></p>
<p>La référence pour les options et commandes de la ligne de commande est:
<a class="reference external" href="https://docs.docker.com/engine/reference/commandline/cli/">Use the Docker command line</a> <a class="footnote-reference brackets" href="#id26" id="id27">13</a></p>
</div>
<div class="section" id="retour-dans-la-doc-officielle">
<h2><a class="toc-backref" href="#sommaire">Retour dans la doc officielle.</a><a class="headerlink" href="#retour-dans-la-doc-officielle" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://docs.docker.com/develop/">Rappel du chemin vers la doc officielle</a> <a class="footnote-reference brackets" href="#id28" id="id29">14</a></p>
<ul class="simple">
<li><p>Use multi-stage builds to keep your images lean : c’est déjà du Docker de haut vol !</p></li>
<li><p>Manage application data using volumes and bind mounts</p></li>
<li><p>Scale your app with Kubernetes</p></li>
<li><p>Scale your app as a Swarm service</p></li>
<li><p>General application development best practices</p></li>
</ul>
<p>J’attaque le premier point mais c’est plus le deuxième qui m’intéresse</p>
</div>
<div class="section" id="commandes-principales">
<h2><a class="toc-backref" href="#sommaire">Commandes principales</a><a class="headerlink" href="#commandes-principales" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il y a des centaines de commandes docker (61 commandes principale en version 19.03).
Caractéristiques : elles commence toutes par docker.
Et même la plupart on des sous commandes. Au total, ça doit peut-être même faire des milliers avec
Chacune des dizaines d’options.</p>
<p>Voir sur <a class="reference external" href="https://poltergeist42.github.io/JDM/Docker.html">Note Docker Pierre</a> <a class="footnote-reference brackets" href="#id1" id="id3">1</a> il y a tout ce qu’il faut !</p>
<p>Cheatsheet ?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run -d -p 8080:80 nginx
docker images &lt;=&gt; docker image ls
docker ps : shows you all containers that are currently running
docker ps -a : shows all containers
docker rmi : efface une ou plusieurs images
docker rm : efface un container
docker start -i container_name
docker restart
docker build -t _nom .
docker container prune &lt;=&gt; docker rm $(docker ps -a -q -f status=exited)
docker run --interactive --tty ubuntu bash
docker inspect container_name
docker stop _nom
docker volume create nomDuVolume
docker volume ls
docker volume inspect nomDuVolume
docker create : comme run mais sans start
</pre></div>
</div>
<p>On ne le dira jamais assez :</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Do not use PowerShell ISE</p>
</div>
<p>Interactive terminals do not work in PowerShell ISE (but they do in PowerShell).
See docker/for-win/issues/223.</p>
</div>
<div class="section" id="creer-une-image">
<h2><a class="toc-backref" href="#sommaire">Créer une image</a><a class="headerlink" href="#creer-une-image" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans un répertoire vierge créer un fichier nommer dockerfile</p>
<p>Lancer la commande docker build (éventuellement avec -t pour préciser un nom d’image)</p>
<div class="section" id="syntaxe-des-fichiers-dockerfile">
<h3><a class="toc-backref" href="#sommaire">Syntaxe des fichiers Dockerfile</a><a class="headerlink" href="#syntaxe-des-fichiers-dockerfile" title="Lien permanent vers ce titre">¶</a></h3>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/">Docker file ref</a> <a class="footnote-reference brackets" href="#id32" id="id33">16</a></p>
<p>Les commandes dans les dockerfile ne sont pas sensibles à la casse mais par convention on les met
en majuscules pour les distinguer des arguments.</p>
<p>Les lignes de commentaire COMMENCE par un #</p>
<p>La commande pour compiler, la plus simple, est alors</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">.</span>
</pre></div>
</div>
<p>Il est bon aussi de bien lire : <a class="reference external" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Best practices for writing Dockerfiles</a> <a class="footnote-reference brackets" href="#id34" id="id35">17</a> :</p>
<p>Mouais, <em>build through stdin</em> ou <em>Understand build context</em> sont plus des possibilités offertes
qu’il faut connaître à mes yeux que des best practices. En revenche ensuite,
<a class="reference external" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#dockerfile-instructions">se trouve de vraies best practices</a> <a class="footnote-reference brackets" href="#id30" id="id31">15</a></p>
<p>comme : ne pas faire apt-get upgrade</p>
<p>Le build ne dispense pas de faire un run ensuite</p>
<p>Les principale commandes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span>
<span class="n">RUN</span>
<span class="n">COPY</span> <span class="o">/</span> <span class="n">ADD</span>
<span class="n">WORKDIR</span>
<span class="n">EXPOSE</span>
<span class="n">VOLUME</span>
<span class="n">CMD</span>
</pre></div>
</div>
<p><a class="reference external" href="https://nickjanetakis.com/blog/docker-tip-2-the-difference-between-copy-and-add-in-a-dockerile">Différence entre ADD et COPY</a> <a class="footnote-reference brackets" href="#id36" id="id37">18</a></p>
</div>
<div class="section" id="un-exercice">
<h3><a class="toc-backref" href="#sommaire">Un exercice</a><a class="headerlink" href="#un-exercice" title="Lien permanent vers ce titre">¶</a></h3>
<p>un ubuntu
installer nano
copier un fichier texte
et se retrouver dans le prompt</p>
<p>Solution:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">dockerfile</span>
 <span class="n">FROM</span> <span class="n">ubuntu</span>

<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">-</span><span class="n">yq</span> \
<span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">nano</span> <span class="o">-</span><span class="n">yq</span>

<span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">mybuntu</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="n">mybuntu</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="syntaxe-des-fichiers-docker-compose">
<h2><a class="toc-backref" href="#sommaire">Syntaxe des fichiers Docker compose</a><a class="headerlink" href="#syntaxe-des-fichiers-docker-compose" title="Lien permanent vers ce titre">¶</a></h2>
<p>Docker compose permet de lancer plusieurs images en même temps.</p>
<p>Dans un répertoire vide (conseillé) créer un fichier docker-compose.yml</p>
<p><a class="reference external" href="https://docs.docker.com/compose/compose-file/">Compose file version 3 reference</a> <a class="footnote-reference brackets" href="#id38" id="id39">19</a></p>
</div>
<div class="section" id="piloter-un-port-serie-de-la-machine-hote">
<h2><a class="toc-backref" href="#sommaire">Piloter un port série de la machine hote</a><a class="headerlink" href="#piloter-un-port-serie-de-la-machine-hote" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://www.losant.com/blog/how-to-access-serial-devices-in-docker">https://www.losant.com/blog/how-to-access-serial-devices-in-docker</a></p>
</div>
<div class="section" id="volumes-et-bind-mounts">
<h2><a class="toc-backref" href="#sommaire">volumes et bind mounts</a><a class="headerlink" href="#volumes-et-bind-mounts" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce sont 2 manières différentes d’avoir des données persistantes.</p>
<p>Les volumes sont mieux que les binds mounts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">Volumes</span> <span class="n">are</span> <span class="n">easier</span> <span class="n">to</span> <span class="n">back</span> <span class="n">up</span> <span class="ow">or</span> <span class="n">migrate</span> <span class="n">than</span> <span class="n">bind</span> <span class="n">mounts</span><span class="o">.</span>
<span class="o">-</span> <span class="n">You</span> <span class="n">can</span> <span class="n">manage</span> <span class="n">volumes</span> <span class="n">using</span> <span class="n">Docker</span> <span class="n">CLI</span> <span class="n">commands</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">Docker</span> <span class="n">API</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Volumes</span> <span class="n">work</span> <span class="n">on</span> <span class="n">both</span> <span class="n">Linux</span> <span class="ow">and</span> <span class="n">Windows</span> <span class="n">containers</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Volumes</span> <span class="n">can</span> <span class="n">be</span> <span class="n">more</span> <span class="n">safely</span> <span class="n">shared</span> <span class="n">among</span> <span class="n">multiple</span> <span class="n">containers</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Volume</span> <span class="n">drivers</span> <span class="n">let</span> <span class="n">you</span> <span class="n">store</span> <span class="n">volumes</span> <span class="n">on</span> <span class="n">remote</span> <span class="n">hosts</span> <span class="ow">or</span> <span class="n">cloud</span> <span class="n">providers</span><span class="p">,</span> <span class="n">to</span> <span class="n">encrypt</span> <span class="n">the</span>
  <span class="n">contents</span> <span class="n">of</span> <span class="n">volumes</span><span class="p">,</span> <span class="ow">or</span> <span class="n">to</span> <span class="n">add</span> <span class="n">other</span> <span class="n">functionality</span><span class="o">.</span>
<span class="o">-</span> <span class="n">New</span> <span class="n">volumes</span> <span class="n">can</span> <span class="n">have</span> <span class="n">their</span> <span class="n">content</span> <span class="n">pre</span><span class="o">-</span><span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">container</span><span class="o">.</span>
</pre></div>
</div>
<p>Les volumes sont indépendants de la structure du filesystem de la machine hôte.
<code class="docutils literal notranslate"><span class="pre">When</span> <span class="pre">you</span> <span class="pre">use</span> <span class="pre">a</span> <span class="pre">bind</span> <span class="pre">mount,</span> <span class="pre">a</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">host</span> <span class="pre">machine</span> <span class="pre">is</span> <span class="pre">mounted</span> <span class="pre">into</span> <span class="pre">a</span> <span class="pre">container.</span></code></p>
<p>Il y a 2 syntaxes possibles –mount ou –volume (abrégeable en -v). La syntaxe –mount est plus
simple</p>
<p>Les volumes sont stockés quelque part dans le système Docker mais on ne sait pas trop bien où.
Non, on pourrait préciser un répertoire dans la commande -v mais ce n’est pas claire dans la doc
C’est sous-entendu sur le site de <a class="reference external" href="https://devopssec.fr/article/fonctionnement-manipulation-volumes-docker">AJDAINI Hatim article sur les volumes</a> <a class="footnote-reference brackets" href="#id40" id="id41">20</a></p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Les options de syntaxe -v ou –mount peuvent aussi bien être utilisées pour monter un volume
que pour faire du bind mount</p>
</div>
<p>On peut soit créer un volume avec des commandes Docker docker volume create ou directement quand
on lance un container avec l’option -v de la commande run</p>
<p><code class="docutils literal notranslate"><span class="pre">when</span> <span class="pre">you</span> <span class="pre">use</span> <span class="pre">a</span> <span class="pre">volume,</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">directory</span> <span class="pre">is</span> <span class="pre">created</span> <span class="pre">within</span> <span class="pre">Docker’s</span> <span class="pre">storage</span> <span class="pre">directory</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">host</span>
<span class="pre">machine,</span> <span class="pre">and</span> <span class="pre">Docker</span> <span class="pre">manages</span> <span class="pre">that</span> <span class="pre">directory’s</span> <span class="pre">contents.</span></code></p>
<p><a class="reference external" href="https://docs.docker.com/storage/volumes/">Doc officielle sur les volumes</a> <a class="footnote-reference brackets" href="#id42" id="id43">21</a> et <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/volume/">référence officielle des commandes docker volume</a> <a class="footnote-reference brackets" href="#id44" id="id45">22</a></p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Fonctionne sous windows10: docker run -ti -v %cd%:/tmp mybuntu
(à condition d’être dans le bon répertoire)</p>
</div>
<p>La syntaxe powershell est différent ainsi que sous Linux</p>
<p><a class="reference external" href="https://stackoverflow.com/questions/41485217/mount-current-directory-as-a-volume-in-docker-on-windows-10">Syntaxe current dir sous Stackoverflow</a> <a class="footnote-reference brackets" href="#id46" id="id47">23</a></p>
<p><strong>Encore quelques informations tirées de la doc officielle sur les volumes:</strong></p>
<ul>
<li><p>Un volume peut être créé ou monté en read only, par plusieurs container en même temps.</p></li>
<li><p>Les volumes drivers sont des plugin qui permettent de créer des volumes à l’extérieur du système
Docker comme <em>vieux/sshfs plugin</em></p>
<p><a class="reference external" href="https://docs.docker.com/storage/volumes/#use-a-volume-driver">Doc sur les volumes drivers</a> <a class="footnote-reference brackets" href="#id48" id="id49">24</a></p>
</li>
</ul>
</div>
<div class="section" id="volume-et-sauvegarde">
<h2><a class="toc-backref" href="#sommaire">Volume et sauvegarde</a><a class="headerlink" href="#volume-et-sauvegarde" title="Lien permanent vers ce titre">¶</a></h2>
<p>En parcourant la doc sur les volumes, après <em>start a container with volume</em>, je suis tombé sur :
<em>start a service with volumes</em> ! ? Qu’est-ce donc que cette histoire de service ?
Voir <a class="reference internal" href="#docker-services-swarm">Docker services/Swarm</a></p>
<p>La sauvegarde :</p>
<p>En fait, l’idée est de monter un container avec un bind et un –volume-from un autre container nommé
et de faire un tar cvf du volume vers le bind !!</p>
<p><a class="reference external" href="https://docs.docker.com/storage/volumes/#backup-a-container">Tout ceci expliqué dans la doc officielle</a> <a class="footnote-reference brackets" href="#id50" id="id51">25</a></p>
<p>Et pour la restauration, on procède de manière inverse.</p>
</div>
<div class="section" id="networks">
<h2><a class="toc-backref" href="#sommaire">Networks</a><a class="headerlink" href="#networks" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://docs.docker.com/network/">Doc officielle networking</a> <a class="footnote-reference brackets" href="#id52" id="id53">26</a></p>
<p>Tout d’abord, il faut savoir qu’il y a 5 type de driver de réseau dans Docker:</p>
<ul class="simple">
<li><p><strong>User-defined bridge</strong> networks are best when you need multiple containers to communicate on
the same Docker host.</p></li>
<li><p><strong>Host networks</strong> are best when the network stack should not be isolated from the Docker host,
but you want other aspects of the container to be isolated.</p></li>
<li><p><strong>Overlay networks</strong> are best when you need containers running on different Docker hosts to
communicate, or when multiple applications work together using swarm services.</p></li>
<li><p><strong>Macvlan networks</strong> are best when you are migrating from a VM setup or need your containers
to look like physical hosts on your network, each with a unique MAC address.</p></li>
<li><p><strong>Third-party network</strong> plugins allow you to integrate Docker with specialized network stacks.</p></li>
</ul>
<p>Pour mon usage, le driver par défaut semble suffisant. Les autres drivers sont surtout utile pour
des container fonctionnant sur des démon différents. Et surtout les user-define bridge apparemment.</p>
<p>Par défaut docker crée un bridge nommé bridge.</p>
<p>Il y a comme pour les volumes des commandes pour gérer les network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">network</span> <span class="n">ls</span>
<span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">avec</span> <span class="n">un</span> <span class="n">nom</span>
<span class="n">docker</span> <span class="n">network</span> <span class="n">create</span>
<span class="n">docker</span> <span class="n">network</span> <span class="n">connect</span> <span class="n">et</span> <span class="n">disconnect</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.docker.com/network/bridge/">Doc officielle docker network bridge</a> <a class="footnote-reference brackets" href="#id54" id="id55">27</a></p>
<p>Et aussi <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/network_create/">la référence de la ligne de commande docker network create</a> <a class="footnote-reference brackets" href="#id56" id="id57">28</a></p>
</div>
<div class="section" id="docker-services-swarm">
<h2><a class="toc-backref" href="#sommaire">Docker services/Swarm</a><a class="headerlink" href="#docker-services-swarm" title="Lien permanent vers ce titre">¶</a></h2>
<p>Notion de Swarm : Un Swarm est un groupe de machines exécutant le moteur Docker et faisant partie
du même cluster. Docker swarm vous permet de lancer des commandes Docker auxquelles vous êtes
habitué sur un cluster depuis une machine maître nommée manager/leader Swarm. Quand des machines
rejoignent un Swarm, elles sont appelés nœuds.</p>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/service/">Page officielle de la documentation sur les service</a> <a class="footnote-reference brackets" href="#id58" id="id59">29</a></p>
<p><a class="reference external" href="https://devopssec.fr/article/comprendre-gerer-manipuler-un-cluster-docker-swarm">Source ci-dessus sur devopssec.fr</a> <a class="footnote-reference brackets" href="#id60" id="id61">30</a></p>
</div>
<div class="section" id="general-application-development-best-practices">
<h2><a class="toc-backref" href="#sommaire">General application development best practices</a><a class="headerlink" href="#general-application-development-best-practices" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://docs.docker.com/develop/dev-best-practices/">Page officielle Docker development best practices</a> <a class="footnote-reference brackets" href="#id62" id="id63">31</a></p>
<p>On this page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">How</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">your</span> <span class="n">images</span> <span class="n">small</span>
<span class="n">Where</span> <span class="ow">and</span> <span class="n">how</span> <span class="n">to</span> <span class="n">persist</span> <span class="n">application</span> <span class="n">data</span>
<span class="n">Use</span> <span class="n">CI</span><span class="o">/</span><span class="n">CD</span> <span class="k">for</span> <span class="n">testing</span> <span class="ow">and</span> <span class="n">deployment</span>
<span class="n">Differences</span> <span class="ow">in</span> <span class="n">development</span> <span class="ow">and</span> <span class="n">production</span> <span class="n">environments</span>
</pre></div>
</div>
<p>Il s’agit de règles de bon sens : commencer avec une image appropriée…</p>
<p>Un point intéressant dans la première partie <em>How to keep your images small</em> est</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">keep</span> <span class="n">your</span> <span class="n">production</span> <span class="n">image</span> <span class="n">lean</span> <span class="n">but</span> <span class="n">allow</span> <span class="k">for</span> <span class="n">debugging</span><span class="p">,</span> <span class="n">consider</span> <span class="n">using</span> <span class="n">the</span> <span class="n">production</span> <span class="n">image</span> <span class="k">as</span>
<span class="n">the</span> <span class="n">base</span> <span class="n">image</span> <span class="k">for</span> <span class="n">the</span> <span class="n">debug</span> <span class="n">image</span><span class="o">.</span> <span class="n">Additional</span> <span class="n">testing</span> <span class="ow">or</span> <span class="n">debugging</span> <span class="n">tooling</span> <span class="n">can</span> <span class="n">be</span> <span class="n">added</span> <span class="n">on</span> <span class="n">top</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">production</span> <span class="n">image</span><span class="o">.</span>
</pre></div>
</div>
<p>Dans la deuxième partie:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Avoid storing application data in your container’s writable layer using storage drivers
</pre></div>
</div>
<p>Je ne savais même pas qu’on pouvait le faire !</p>
<p>One case where it is appropriate to use bind mounts is during development.
For production, use a volume instead,</p>
</div>
<div class="section" id="acceder-aux-donnees-cachees-de-docker-sous-windows-y-compris-les-volumes">
<h2><a class="toc-backref" href="#sommaire">Accéder aux données cachées de Docker sous Windows y compris les volumes</a><a class="headerlink" href="#acceder-aux-donnees-cachees-de-docker-sous-windows-y-compris-les-volumes" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition hint">
<p class="admonition-title">Indication</p>
<p>If you have linux containers on a Windows 10 machine, containers are stored in
the MobyLinuxVM.vhdx file. You can’t mount or explore that file AFAIK, but you can still list
the containers inside that machine using this “blue pill” trick
blog.jongallant.com/2017/11/ssh-into-docker-vm-windows by default containers are stored
in the linux path /var/lib/docker in that virtual machine (you can confirm that linux path
from a docker info command)</p>
</div>
<p>Et effectivement j’ai testé:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">privileged</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> <span class="n">jongallant</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">client</span>
</pre></div>
</div>
<p>On se retrouve alors dans un container (option -it) où on lance un deuxième container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">net</span><span class="o">=</span><span class="n">host</span> <span class="o">--</span><span class="n">ipc</span><span class="o">=</span><span class="n">host</span> <span class="o">--</span><span class="n">uts</span><span class="o">=</span><span class="n">host</span> <span class="o">--</span><span class="n">pid</span><span class="o">=</span><span class="n">host</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">security</span><span class="o">-</span><span class="n">opt</span><span class="o">=</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span> <span class="o">--</span><span class="n">privileged</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">host</span> <span class="n">alpine</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
</pre></div>
</div>
<p>On a alors un prompt et on peut y taper chroot /host… Nouveau prompt mais d’aspect identique au
précédent (seul un ls peut révéler qu’on a changé d’endroit).</p>
<p>Dans cet endroit un ls à la racine donne des choses bizarre ! Mais ce qui importe c’est ce qui
se trouve dans le dossier /var/lib/docker</p>
<p>La cession complète:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">privileged</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> <span class="n">jongallant</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">client</span>
<span class="n">root</span><span class="o">@</span><span class="mi">693563</span><span class="n">b5330f</span><span class="p">:</span><span class="o">/</span><span class="c1"># ls</span>
<span class="nb">bin</span>  <span class="n">boot</span>  <span class="n">dev</span>  <span class="n">etc</span>  <span class="n">home</span>  <span class="n">lib</span>  <span class="n">lib64</span>  <span class="n">media</span>  <span class="n">mnt</span>  <span class="n">opt</span>  <span class="n">proc</span>  <span class="n">root</span>  <span class="n">run</span>  <span class="n">sbin</span>  <span class="n">srv</span>  <span class="n">sys</span>  <span class="n">tmp</span>  <span class="n">usr</span>  <span class="n">var</span>
<span class="n">root</span><span class="o">@</span><span class="mi">693563</span><span class="n">b5330f</span><span class="p">:</span><span class="o">/</span><span class="c1"># docker run --net=host --ipc=host --uts=host --pid=host -it --security-opt=seccomp=unconfined --privileged --rm -v /:/host alpine /bin/sh</span>
<span class="o">/</span> <span class="c1"># ls</span>
<span class="nb">bin</span>    <span class="n">dev</span>    <span class="n">etc</span>    <span class="n">home</span>   <span class="n">host</span>   <span class="n">lib</span>    <span class="n">media</span>  <span class="n">mnt</span>    <span class="n">opt</span>    <span class="n">proc</span>   <span class="n">root</span>   <span class="n">run</span>    <span class="n">sbin</span>   <span class="n">srv</span>    <span class="n">sys</span>    <span class="n">tmp</span>    <span class="n">usr</span>    <span class="n">var</span>
<span class="o">/</span> <span class="c1"># chroot /host</span>
<span class="o">/</span> <span class="c1"># pwd</span>
<span class="o">/</span>
<span class="o">/</span> <span class="c1"># ls</span>
<span class="n">A</span>  <span class="n">C</span>  <span class="n">E</span>  <span class="n">G</span>  <span class="n">I</span>  <span class="n">K</span>  <span class="n">M</span>  <span class="n">O</span>  <span class="n">Q</span>  <span class="n">S</span>  <span class="n">U</span>  <span class="n">W</span>  <span class="n">Y</span>  <span class="n">a</span>  <span class="nb">bin</span>  <span class="n">d</span>    <span class="n">e</span>    <span class="n">f</span>  <span class="n">h</span>     <span class="n">host_mnt</span>  <span class="n">j</span>  <span class="n">l</span>    <span class="n">m</span>      <span class="n">mnt</span>  <span class="n">o</span>    <span class="n">p</span>     <span class="n">q</span>  <span class="n">root</span>  <span class="n">s</span>     <span class="n">sendtohost</span>  <span class="n">sys</span>  <span class="n">tmp</span>  <span class="n">usr</span>  <span class="n">var</span>  <span class="n">x</span>  <span class="n">z</span>
<span class="n">B</span>  <span class="n">D</span>  <span class="n">F</span>  <span class="n">H</span>  <span class="n">J</span>  <span class="n">L</span>  <span class="n">N</span>  <span class="n">P</span>  <span class="n">R</span>  <span class="n">T</span>  <span class="n">V</span>  <span class="n">X</span>  <span class="n">Z</span>  <span class="n">b</span>  <span class="n">c</span>    <span class="n">dev</span>  <span class="n">etc</span>  <span class="n">g</span>  <span class="n">home</span>  <span class="n">i</span>         <span class="n">k</span>  <span class="n">lib</span>  <span class="n">media</span>  <span class="n">n</span>    <span class="n">opt</span>  <span class="n">proc</span>  <span class="n">r</span>  <span class="n">run</span>   <span class="n">sbin</span>  <span class="n">srv</span>         <span class="n">t</span>    <span class="n">u</span>    <span class="n">v</span>    <span class="n">w</span>    <span class="n">y</span>
<span class="o">/</span> <span class="c1"># cd /var/lib/docker</span>
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span> <span class="c1"># ls</span>
<span class="n">builder</span>  <span class="n">buildkit</span>  <span class="n">containerd</span>  <span class="n">containers</span>  <span class="n">image</span>  <span class="n">network</span>  <span class="n">overlay2</span>  <span class="n">plugins</span>  <span class="n">runtimes</span>  <span class="n">swarm</span>  <span class="n">tmp</span>  <span class="n">trust</span>  <span class="n">volumes</span>
</pre></div>
</div>
</div>
<div class="section" id="my-tips">
<h2><a class="toc-backref" href="#sommaire">My tips</a><a class="headerlink" href="#my-tips" title="Lien permanent vers ce titre">¶</a></h2>
<p>Mode interractif : je suis resté blocké sur ce pb: soit un nginx lancer en mode ti avec en plus -d
Comment on inteeragit avec le container (à part par le navigateur)</p>
<p>Comment sait-on qu’un container a été lancé en mode ti ?</p>
<p id="index-1">Disque image locations : peut-être configurer dans la fenêtre setting de docker onglet Ressources/
advanced</p>
<p id="index-2">Partage de données entre hôte et containers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="n">sharing</span> <span class="ow">is</span> <span class="n">required</span> <span class="k">for</span> <span class="n">mounting</span> <span class="n">volumes</span> <span class="ow">in</span> <span class="n">Linux</span> <span class="n">containers</span><span class="p">,</span> <span class="ow">not</span> <span class="k">for</span> <span class="n">Windows</span> <span class="n">containers</span><span class="o">.</span>
<span class="n">For</span> <span class="n">Linux</span> <span class="n">containers</span><span class="p">,</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">share</span> <span class="n">the</span> <span class="n">drive</span> <span class="n">where</span> <span class="n">the</span> <span class="n">Dockerfile</span> <span class="ow">and</span> <span class="n">volume</span> <span class="n">are</span> <span class="n">located</span><span class="o">.</span>
<span class="n">Otherwise</span><span class="p">,</span> <span class="n">you</span> <span class="n">get</span> <span class="n">file</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">or</span> <span class="n">cannot</span> <span class="n">start</span> <span class="n">service</span> <span class="n">errors</span> <span class="n">at</span> <span class="n">runtime</span><span class="o">.</span>
<span class="n">See</span> <span class="n">Volume</span> <span class="n">mounting</span> <span class="n">requires</span> <span class="n">shared</span> <span class="n">drives</span> <span class="k">for</span> <span class="n">Linux</span> <span class="n">containers</span><span class="o">.</span>
</pre></div>
</div>
<p>Docker dashboard : gestion intéractive graphique des container/appli compose
<strong>en cours d’éxécution</strong></p>
<div class="section" id="docker-port">
<h3><a class="toc-backref" href="#sommaire">Docker port</a><a class="headerlink" href="#docker-port" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans docker port container_name
L’affichage produit est</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">container</span> <span class="o">--&gt;</span> <span class="n">localhost</span><span class="p">:</span><span class="n">port</span>
</pre></div>
</div>
<p>Alors que dans:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">80</span> <span class="n">site</span>
</pre></div>
</div>
<p>On a d’abord le port de l’hôte suivi du port de l’image !</p>
</div>
<div class="section" id="faire-du-python2-sans-l-installer">
<h3><a class="toc-backref" href="#sommaire">Faire du python2 sans l’installer</a><a class="headerlink" href="#faire-du-python2-sans-l-installer" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">python</span><span class="p">:</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="docker-run-start-and-restart">
<h3><a class="toc-backref" href="#sommaire">docker run, start and restart</a><a class="headerlink" href="#docker-run-start-and-restart" title="Lien permanent vers ce titre">¶</a></h3>
<p>run créé un nouveau container avec un nouveau top layer vierge.</p>
<p>start permet de relancer un container arrêté sans perdre les données temporaire</p>
<p>restart fair un stop puis un start !</p>
</div>
<div class="section" id="savoir-si-une-image-a-ete-montee-avec-un-volume-ou-un-bind">
<h3><a class="toc-backref" href="#sommaire">Savoir si une image a été montée avec un volume ou un bind</a><a class="headerlink" href="#savoir-si-une-image-a-ete-montee-avec-un-volume-ou-un-bind" title="Lien permanent vers ce titre">¶</a></h3>
<p>docker inspect container_name</p>
</div>
<div class="section" id="docker-run-name-rm">
<h3><a class="toc-backref" href="#sommaire">Docker run –name –rm</a><a class="headerlink" href="#docker-run-name-rm" title="Lien permanent vers ce titre">¶</a></h3>
<p>Tout est dans le titre, on peut donner un titre à container ! ne s’abrège pas.</p>
<p>–rm le supprime quand on sort, très pratique pour les tests de la commande run elle-même</p>
</div>
</div>
<div class="section" id="voir-docker-a-l-oeuvre">
<span id="index-3"></span><h2><a class="toc-backref" href="#sommaire">Voir Docker à l’oeuvre</a><a class="headerlink" href="#voir-docker-a-l-oeuvre" title="Lien permanent vers ce titre">¶</a></h2>
<p>L”<a class="reference external" href="https://hub.docker.com/r/prakhar1989/catnip">exemple de prakhar1989 catnip</a> <a class="footnote-reference brackets" href="#id64" id="id65">32</a> dont le fichier dockerfile est accessible sous github.</p>
<p><a class="reference external" href="https://docs.docker.com/samples/">Docker sample home</a> <a class="footnote-reference brackets" href="#id66" id="id67">33</a></p>
</div>
<div class="section" id="vocabulaire">
<h2><a class="toc-backref" href="#sommaire">Vocabulaire</a><a class="headerlink" href="#vocabulaire" title="Lien permanent vers ce titre">¶</a></h2>
<p id="index-4">Stateful vs Stateless : se dit à propos d’une application ou d’un service et par extension cela
s’applique aux container.</p>
<p><a class="reference external" href="https://www.contino.io/insights/stateless-vs-stateful-containers-whats-the-difference-and-why-does-it-matter">Stateless vs Stateful article sur contino.io</a> <a class="footnote-reference brackets" href="#id68" id="id69">34</a></p>
<p>A stateless application is one that neither reads nor stores information about its state from
one time that it is run to the next.</p>
<p>Une <a class="reference external" href="https://blog.engineering.publicissapient.fr/2007/07/24/service-stateful-vs-service-stateless/">explication sur Publicis Sapiens</a> <a class="footnote-reference brackets" href="#id70" id="id71">35</a></p>
<p>Un moyen de stockage est nécessaire pour une application, un service stateful.</p>
<p>Images :</p>
<blockquote>
<div><p><strong>Base images</strong> are images that have no parent image, usually images with an OS like ubuntu, busybox or debian.</p>
<p><strong>Child images</strong> are images that build on base images and add additional functionality.</p>
</div></blockquote>
<p>Then there are official and user images, which can be both base and child images.</p>
<blockquote>
<div><p><strong>Official images</strong> are images that are officially maintained and supported by the folks at
Docker. These are typically one word long. In the list of images above, the python, ubuntu,
busybox and hello-world images are official images.</p>
<p><strong>User images</strong> are images created and shared by users like you and me. They build on base
images and add additional functionality. Typically, these are formatted as user/image-name.</p>
</div></blockquote>
<p id="index-5"><strong>detached mode</strong> mode détaché : à compléter le 6/07/2020, en gros c’est la même chose que &amp;
à la fin d’un commande Linux</p>
<p>Swarm mode</p>
</div>
<div class="section" id="weblinks">
<h2><a class="toc-backref" href="#sommaire">Weblinks</a><a class="headerlink" href="#weblinks" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id1"><span class="brackets">1</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id3">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://poltergeist42.github.io/JDM/Docker.html">https://poltergeist42.github.io/JDM/Docker.html</a></p>
</dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id5">2</a></span></dt>
<dd><p><a class="reference external" href="https://openclassrooms.com/fr/courses/2035766-optimisez-votre-deploiement-en-creant-des-conteneurs-avec-docker/6211306-decouvrez-les-conteneurs">https://openclassrooms.com/fr/courses/2035766-optimisez-votre-deploiement-en-creant-des-conteneurs-avec-docker/6211306-decouvrez-les-conteneurs</a></p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id7">3</a></span></dt>
<dd><p><a class="reference external" href="https://docker-curriculum.com/">https://docker-curriculum.com/</a></p>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id9">4</a></span></dt>
<dd><p><a class="reference external" href="https://hub.docker.com/search?q=&amp;type=image">https://hub.docker.com/search?q=&amp;type=image</a></p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id11">5</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/get-started/">https://docs.docker.com/get-started/</a></p>
</dd>
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id13">6</a></span></dt>
<dd><p><a class="reference external" href="https://blog.engineering.publicissapient.fr/2019/12/23/docker-est-mort-vive-docker/">https://blog.engineering.publicissapient.fr/2019/12/23/docker-est-mort-vive-docker/</a></p>
</dd>
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id15">7</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/get-started/overview/#docker-architecture">https://docs.docker.com/get-started/overview/#docker-architecture</a></p>
</dd>
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id17">8</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/storage/storagedriver/#images-and-layers">https://docs.docker.com/storage/storagedriver/#images-and-layers</a></p>
</dd>
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id19">9</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/">https://docs.docker.com/</a></p>
</dd>
<dt class="label" id="id20"><span class="brackets"><a class="fn-backref" href="#id21">10</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/install/">https://docs.docker.com/install/</a></p>
</dd>
<dt class="label" id="id22"><span class="brackets"><a class="fn-backref" href="#id23">11</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/docker-for-windows/">https://docs.docker.com/docker-for-windows/</a></p>
</dd>
<dt class="label" id="id24"><span class="brackets"><a class="fn-backref" href="#id25">12</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/docker-for-mac/">https://docs.docker.com/docker-for-mac/</a></p>
</dd>
<dt class="label" id="id26"><span class="brackets"><a class="fn-backref" href="#id27">13</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/cli/">https://docs.docker.com/engine/reference/commandline/cli/</a></p>
</dd>
<dt class="label" id="id28"><span class="brackets"><a class="fn-backref" href="#id29">14</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/develop/">https://docs.docker.com/develop/</a></p>
</dd>
<dt class="label" id="id30"><span class="brackets"><a class="fn-backref" href="#id31">15</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#dockerfile-instructions">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#dockerfile-instructions</a></p>
</dd>
<dt class="label" id="id32"><span class="brackets"><a class="fn-backref" href="#id33">16</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
</dd>
<dt class="label" id="id34"><span class="brackets"><a class="fn-backref" href="#id35">17</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a></p>
</dd>
<dt class="label" id="id36"><span class="brackets"><a class="fn-backref" href="#id37">18</a></span></dt>
<dd><p><a class="reference external" href="https://nickjanetakis.com/blog/docker-tip-2-the-difference-between-copy-and-add-in-a-dockerile">https://nickjanetakis.com/blog/docker-tip-2-the-difference-between-copy-and-add-in-a-dockerile</a></p>
</dd>
<dt class="label" id="id38"><span class="brackets"><a class="fn-backref" href="#id39">19</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></p>
</dd>
<dt class="label" id="id40"><span class="brackets"><a class="fn-backref" href="#id41">20</a></span></dt>
<dd><p><a class="reference external" href="https://devopssec.fr/article/fonctionnement-manipulation-volumes-docker">https://devopssec.fr/article/fonctionnement-manipulation-volumes-docker</a></p>
</dd>
<dt class="label" id="id42"><span class="brackets"><a class="fn-backref" href="#id43">21</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/storage/volumes/">https://docs.docker.com/storage/volumes/</a></p>
</dd>
<dt class="label" id="id44"><span class="brackets"><a class="fn-backref" href="#id45">22</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/volume/">https://docs.docker.com/engine/reference/commandline/volume/</a></p>
</dd>
<dt class="label" id="id46"><span class="brackets"><a class="fn-backref" href="#id47">23</a></span></dt>
<dd><p><a class="reference external" href="https://stackoverflow.com/questions/41485217/mount-current-directory-as-a-volume-in-docker-on-windows-10">https://stackoverflow.com/questions/41485217/mount-current-directory-as-a-volume-in-docker-on-windows-10</a></p>
</dd>
<dt class="label" id="id48"><span class="brackets"><a class="fn-backref" href="#id49">24</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/storage/volumes/#use-a-volume-driver">https://docs.docker.com/storage/volumes/#use-a-volume-driver</a></p>
</dd>
<dt class="label" id="id50"><span class="brackets"><a class="fn-backref" href="#id51">25</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/storage/volumes/#backup-a-container">https://docs.docker.com/storage/volumes/#backup-a-container</a></p>
</dd>
<dt class="label" id="id52"><span class="brackets"><a class="fn-backref" href="#id53">26</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/network/">https://docs.docker.com/network/</a></p>
</dd>
<dt class="label" id="id54"><span class="brackets"><a class="fn-backref" href="#id55">27</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/network/bridge/">https://docs.docker.com/network/bridge/</a></p>
</dd>
<dt class="label" id="id56"><span class="brackets"><a class="fn-backref" href="#id57">28</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/network_create/">https://docs.docker.com/engine/reference/commandline/network_create/</a></p>
</dd>
<dt class="label" id="id58"><span class="brackets"><a class="fn-backref" href="#id59">29</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/service/">https://docs.docker.com/engine/reference/commandline/service/</a></p>
</dd>
<dt class="label" id="id60"><span class="brackets"><a class="fn-backref" href="#id61">30</a></span></dt>
<dd><p><a class="reference external" href="https://devopssec.fr/article/comprendre-gerer-manipuler-un-cluster-docker-swarm">https://devopssec.fr/article/comprendre-gerer-manipuler-un-cluster-docker-swarm</a></p>
</dd>
<dt class="label" id="id62"><span class="brackets"><a class="fn-backref" href="#id63">31</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/develop/dev-best-practices/">https://docs.docker.com/develop/dev-best-practices/</a></p>
</dd>
<dt class="label" id="id64"><span class="brackets"><a class="fn-backref" href="#id65">32</a></span></dt>
<dd><p><a class="reference external" href="https://hub.docker.com/r/prakhar1989/catnip">https://hub.docker.com/r/prakhar1989/catnip</a></p>
</dd>
<dt class="label" id="id66"><span class="brackets"><a class="fn-backref" href="#id67">33</a></span></dt>
<dd><p><a class="reference external" href="https://docs.docker.com/samples/">https://docs.docker.com/samples/</a></p>
</dd>
<dt class="label" id="id68"><span class="brackets"><a class="fn-backref" href="#id69">34</a></span></dt>
<dd><p><a class="reference external" href="https://www.contino.io/insights/stateless-vs-stateful-containers-whats-the-difference-and-why-does-it-matter">https://www.contino.io/insights/stateless-vs-stateful-containers-whats-the-difference-and-why-does-it-matter</a></p>
</dd>
<dt class="label" id="id70"><span class="brackets"><a class="fn-backref" href="#id71">35</a></span></dt>
<dd><p><a class="reference external" href="https://blog.engineering.publicissapient.fr/2007/07/24/service-stateful-vs-service-stateless/">https://blog.engineering.publicissapient.fr/2007/07/24/service-stateful-vs-service-stateless/</a></p>
</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table des matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Docker*</a><ul>
<li><a class="reference internal" href="#start-up-install">Start-up /install</a><ul>
<li><a class="reference internal" href="#dockerhub">Dockerhub</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notes">Notes</a><ul>
<li><a class="reference internal" href="#definitions">Définitions</a></li>
<li><a class="reference internal" href="#ma-presentation-rapide-pratique">Ma présentation rapide pratique</a></li>
<li><a class="reference internal" href="#grands-principes">Grands principes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#retour-dans-la-doc-officielle">Retour dans la doc officielle.</a></li>
<li><a class="reference internal" href="#commandes-principales">Commandes principales</a></li>
<li><a class="reference internal" href="#creer-une-image">Créer une image</a><ul>
<li><a class="reference internal" href="#syntaxe-des-fichiers-dockerfile">Syntaxe des fichiers Dockerfile</a></li>
<li><a class="reference internal" href="#un-exercice">Un exercice</a></li>
</ul>
</li>
<li><a class="reference internal" href="#syntaxe-des-fichiers-docker-compose">Syntaxe des fichiers Docker compose</a></li>
<li><a class="reference internal" href="#piloter-un-port-serie-de-la-machine-hote">Piloter un port série de la machine hote</a></li>
<li><a class="reference internal" href="#volumes-et-bind-mounts">volumes et bind mounts</a></li>
<li><a class="reference internal" href="#volume-et-sauvegarde">Volume et sauvegarde</a></li>
<li><a class="reference internal" href="#networks">Networks</a></li>
<li><a class="reference internal" href="#docker-services-swarm">Docker services/Swarm</a></li>
<li><a class="reference internal" href="#general-application-development-best-practices">General application development best practices</a></li>
<li><a class="reference internal" href="#acceder-aux-donnees-cachees-de-docker-sous-windows-y-compris-les-volumes">Accéder aux données cachées de Docker sous Windows y compris les volumes</a></li>
<li><a class="reference internal" href="#my-tips">My tips</a><ul>
<li><a class="reference internal" href="#docker-port">Docker port</a></li>
<li><a class="reference internal" href="#faire-du-python2-sans-l-installer">Faire du python2 sans l’installer</a></li>
<li><a class="reference internal" href="#docker-run-start-and-restart">docker run, start and restart</a></li>
<li><a class="reference internal" href="#savoir-si-une-image-a-ete-montee-avec-un-volume-ou-un-bind">Savoir si une image a été montée avec un volume ou un bind</a></li>
<li><a class="reference internal" href="#docker-run-name-rm">Docker run –name –rm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#voir-docker-a-l-oeuvre">Voir Docker à l’oeuvre</a></li>
<li><a class="reference internal" href="#vocabulaire">Vocabulaire</a></li>
<li><a class="reference internal" href="#weblinks">Weblinks</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="../git/git.html"
                        title="Chapitre précédent">Notes sur git</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="../arduino/arduino.html"
                        title="Chapitre suivant">Arduino</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docker/docker.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="../arduino/arduino.html" title="Arduino"
             >suivant</a> |</li>
        <li class="right" >
          <a href="../git/git.html" title="Notes sur git"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation MajorLee&#39;s notes </a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, J.SORANZO.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.
    </div>
  </body>
</html>